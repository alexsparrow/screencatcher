(this.webpackJsonpgiffy=this.webpackJsonpgiffy||[]).push([[0],{165:function(e,t,n){e.exports=n(233)},170:function(e,t,n){},172:function(e,t,n){},206:function(e,t){},208:function(e,t){},218:function(e,t){},233:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(11),o=n.n(i),c=(n(170),n(57)),s=n(30),u=n.n(s),l=n(23),d=n(59),h=(n(172),n(6)),m=n(108),g=n.n(m),f=function(e){var t,n,r=e.state,i=e.dispatch,o=e.startCapture,c=e.stopCapture,s=e.durationSecs,u=e.onExport,l=btoa(new Uint8Array(r.png).reduce((function(e,t){return e+String.fromCharCode(t)}),""));return a.a.createElement(h.Navbar,null,a.a.createElement(h.NavbarGroup,null,a.a.createElement(h.NavbarHeading,null,a.a.createElement("h3",null,"screencatcher")),a.a.createElement(h.Button,{disabled:r.isRecording,onClick:function(){return o(0)},icon:"record"},"Record"),a.a.createElement(h.Button,{disabled:!r.isRecording,onClick:c,icon:"stop"},"Stop"),a.a.createElement(h.Button,{disabled:r.isRecording,onClick:function(){return o(1)},icon:"camera"},"Screenshot")),a.a.createElement(h.NavbarGroup,{align:h.Alignment.RIGHT},a.a.createElement(h.Button,{icon:"zoom-to-fit",onClick:function(){return i({type:"startCropping"})}},"Crop"),a.a.createElement(h.NavbarDivider,null),a.a.createElement(h.Popover,{minimal:!0,content:a.a.createElement(h.Menu,null,a.a.createElement(h.MenuItem,{text:"Export to PNG",disabled:r.isConverting,onClick:function(){return u("png")}}),a.a.createElement(h.MenuItem,{text:"Export to GIF",disabled:r.isConverting,onClick:function(){return u("gif")}}),a.a.createElement(h.MenuDivider,null),a.a.createElement(h.MenuItem,{text:"Image Width"},[256,512,1024,2048].map((function(e){return a.a.createElement(h.MenuItem,{key:e,text:"".concat(e),icon:r.gifWidth===e?"tick":null,onClick:function(){return i({type:"setGifWidth",width:e})}})})),r.screenDimensions&&a.a.createElement(h.MenuItem,{key:"original",text:"Original: ".concat(null===(t=r.screenDimensions)||void 0===t?void 0:t[0]),icon:r.gifWidth===(null===(n=r.screenDimensions)||void 0===n?void 0:n[0])?"tick":null,onClick:function(){return i({type:"setGifWidth",width:r.screenDimensions[0]})}})))},a.a.createElement(h.Button,{icon:"export",text:"Export..."})),(r.png||r.gif)&&a.a.createElement(h.Popover,{minimal:!0,content:a.a.createElement(h.Menu,null,a.a.createElement(h.MenuItem,{text:"Download PNG",download:"screencatcher.png",href:"data:image/png;base64,".concat(l),target:"_blank",icon:"download",disabled:!r.png}),a.a.createElement(h.MenuItem,{text:"Download GIF",download:"screencatcher.gif",href:"data:image/gif;base64,".concat(r.gif),target:"_blank",icon:"download",disabled:!r.gif}))},a.a.createElement(h.Button,{icon:"download",text:"Download..."})),r.isConverting&&a.a.createElement(a.a.Fragment,null,a.a.createElement(h.NavbarDivider,null),a.a.createElement("div",{style:{width:"10rem"}},a.a.createElement(h.ProgressBar,{value:r.progress}))),a.a.createElement(h.NavbarDivider,null),"Duration: ",g()(s>0?s:0).format("0.0"),"s"))},p=n(113),v=n(41),w=n.n(v),b=Object(p.a)((function(e){return a.a.createElement("div",{ref:e.getRef,style:{position:"absolute",left:e.x,top:e.y,width:e.width,height:e.height,touchAction:"none",borderWidth:5,borderColor:"red",borderStyle:"solid",pointerEvents:"all"}},a.a.createElement("div",{style:{width:"100%",height:"100%"}},e.x,",",e.y,",",e.width,",",e.height," ",a.a.createElement(h.Button,{onClick:function(){return e.onCrop([e.x,e.y,e.width,e.height])}},"Crop"),a.a.createElement(h.Button,{onClick:function(){return e.onCropCancel()}},"Cancel")))})),E=function(e){var t=e.onCrop,n=e.onCancel,r=a.a.useState({x:0,y:0,width:300,height:200}),i=Object(l.a)(r,2),o=i[0],c=i[1];return a.a.createElement(b,Object.assign({onCrop:t,onCropCancel:n,resizable:{edges:{left:!0,right:!0,bottom:!0,top:!0},modifiers:[w.a.modifiers.restrictRect({restriction:"parent"})]},draggable:{modifiers:[w.a.modifiers.restrictRect({restriction:"parent"})]},onDragMove:function(e){return c((function(t){return{x:t.x+e.dx,y:t.y+e.dy,width:t.width,height:t.height}}))},onResizeMove:function(e){var t=e.rect,n=t.width,r=t.height,a=e.deltaRect,i=a.left,o=a.top;c((function(e){return{x:e.x+i,y:e.y+o,width:n,height:r}}))}},o))},y=function(e){var t=e.frames,n=e.width,i=e.height,o=e.displayWidth,c=e.displayHeight,s=a.a.useRef(null);return Object(r.useEffect)((function(){!function(){var e=0,n=Date.now(),r=s.current.getContext("2d");requestAnimationFrame((function a(){Date.now()-n>=t[e].timestamp&&(null===r||void 0===r||r.putImageData(t[e].imageData,0,0),(e+=1)>=t.length&&(e=0,n=Date.now())),requestAnimationFrame(a)}))}()}),[s,t]),a.a.createElement("canvas",{ref:s,width:n,height:i,style:{maxHeight:"100%",height:c,maxWidth:"100%",width:o,margin:"auto"}})},C=n(116),k=n(22),x={chunks:[],chunksUrl:"",isRecording:!1,isConverting:!1,screenDimensions:null,png:null,gif:null,gifWidth:1024,isCropping:!1,cropDimensions:null,progress:0,hasData:!1},D=function(e,t){switch(t.type){case"startRecording":return Object(k.a)({},e,{isRecording:!0,hasData:!0});case"recordChunk":return Object(k.a)({},e,{chunks:[].concat(Object(C.a)(e.chunks),[t.chunk])});case"stopRecording":return Object(k.a)({},e,{isRecording:!1,chunksUrl:URL.createObjectURL(e.chunks[0]),screenDimensions:[t.captureStream.getVideoTracks()[0].getSettings().width,t.captureStream.getVideoTracks()[0].getSettings().height]});case"startExport":return Object(k.a)({},e,{isConverting:!0});case"endExport":return Object(k.a)({},e,{isConverting:!1,progress:0,png:t.png?t.png:e.png,gif:t.gif?t.gif:e.gif});case"setGifWidth":return Object(k.a)({},e,{gifWidth:t.width});case"startCropping":return Object(k.a)({},e,{isCropping:!0});case"endCropping":return Object(k.a)({},e,{isCropping:!1,cropDimensions:t.dimensions?t.dimensions:e.cropDimensions});case"setProgress":return Object(k.a)({},e,{progress:t.progress})}return e},O=n(72),j=n(73),R=n(114),I=n.n(R),M=n(115),W=n.n(M),S=function(){function e(t,n){Object(O.a)(this,e),this.encoder=void 0,this.encoder=new I.a(t,n,{highWaterMark:5e7})}return Object(j.a)(e,[{key:"start",value:function(){this.encoder.writeHeader()}},{key:"addFrame",value:function(e,t){this.encoder.addFrame(e)}},{key:"finish",value:function(){return this.encoder.finish(),btoa(this.encoder.read().reduce((function(e,t){return e+String.fromCharCode(t)}),""))}}]),e}(),N=function(){function e(t,n){Object(O.a)(this,e),this.width=void 0,this.height=void 0,this.frames=void 0,this.dels=void 0,this.width=t,this.height=n,this.frames=[],this.dels=[]}return Object(j.a)(e,[{key:"start",value:function(){}},{key:"addFrame",value:function(e,t){this.frames.push(e),this.dels.push(t)}},{key:"finish",value:function(){return W.a.encode(this.frames,this.width,this.height,255,this.dels)}}]),e}();function B(e){return F.apply(this,arguments)}function F(){return(F=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,navigator.mediaDevices.getDisplayMedia(t);case 4:n=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),console.error("Error: "+e.t0),e.abrupt("return",null);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}var G={video:{cursor:"always"},audio:!1},H=function(){var e,t,n=Object(r.useReducer)(D,x),i=Object(l.a)(n,2),o=i[0],s=i[1],m=Object(r.useState)(null),g=Object(l.a)(m,2),p=g[0],v=g[1],w=Object(r.useState)(null),b=Object(l.a)(w,2),C=b[0],k=b[1],O=Object(r.useState)(Date.now()),j=Object(l.a)(O,2),R=j[0],I=j[1],M=Object(r.useRef)([]),W=Object(r.useRef)(null),F=Object(r.useRef)();a.a.useEffect((function(){if(o.hasData){return window.onbeforeunload=function(e){return"You haven't saved your recording. Are you sure you want to leave?"},function(){window.onbeforeunload=null}}}),[o]);var H=function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r,a,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(G);case 2:if(n=e.sent,r=document.createElement("video"),a=document.createElement("canvas"),i=a.getContext("2d"),n){e.next=8;break}return e.abrupt("return");case 8:r.srcObject=n,o=null,r.onloadeddata=function(){W.current=setInterval((function(){o||(o=Date.now(),a.width=r.videoWidth,a.height=r.videoHeight),null===i||void 0===i||i.drawImage(r,0,0),M.current.push({timestamp:Date.now()-o,imageData:null===i||void 0===i?void 0:i.getImageData(0,0,r.videoWidth,r.videoHeight)}),M.current.length===t&&P()}),100)},r.play(),F.current=new MediaRecorder(n),s({type:"startRecording"}),F.current.ondataavailable=function(e){return s({type:"recordChunk",chunk:e.data})},F.current.onstop=function(){s({type:"stopRecording",captureStream:n}),n.getVideoTracks().forEach((function(e){return e.stop()}))},F.current.start(),v(Date.now());case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:F.current&&F.current.stop(),k(Date.now()),clearInterval(W.current);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=Object(r.useRef)(),T=function(e){var t=function(){return{width:e.current.offsetWidth,height:e.current.offsetHeight}},n=Object(r.useState)({width:0,height:0}),a=Object(l.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){var n=function(){o(t())};return e.current&&o(t()),window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[e]),i}(A),U=T.width,z=T.height,L=null===(e=o.screenDimensions)||void 0===e?void 0:e[0],q=null===(t=o.screenDimensions)||void 0===t?void 0:t[1],V=U/z,J=L/q,_=0,Y=0,$=U,K=z;if(J>V){var Q=U/L*q;Y=.5*(z-Q),K=Q}else if(V>J){var X=z/q*L;_=.5*(U-X),$=X}Object(r.useEffect)((function(){setTimeout((function(){return I(Date.now())}),1e3)}),[R]);var Z=((C||R)-(p||R))/1e3;return a.a.createElement("div",{className:"App"},a.a.createElement("main",{className:"bp3-dark"},a.a.createElement(f,{state:o,dispatch:s,durationSecs:Z,onExport:function(e){s({type:"startExport"}),console.log(U,z);var t=1*L/$,n=1*q/K,r=o.cropDimensions,a=r?Math.round(r[0]*t):0,i=r?Math.round(r[1]*n):0,u=r?Math.round(r[2]*t):L,l=r?Math.round(r[3]*n):q,d=r?Math.round(r[2]*t):o.gifWidth,h=r?Math.round(r[3]*n):q*o.gifWidth/L;!function(e,t,n,r,a,i,o,c,s,u,l,d){var h=document.createElement("canvas");h.width=t,h.height=n;var m=h.getContext("2d"),g=document.createElement("canvas");g.width=c,g.height=s;var f=g.getContext("2d"),p=0;d.start();setTimeout((function t(){var n=e[p];u(1*p/e.length),null===m||void 0===m||m.putImageData(n.imageData,0,0),null===f||void 0===f||f.drawImage(h,r,a,i,o,0,0,c,s);var g=null===f||void 0===f?void 0:f.getImageData(0,0,c,s),v=p>=1?e[p-1].timestamp:0;if(d.addFrame(g.data,n.timestamp-v),++p<e.length)setTimeout(t,10);else{var w=d.finish();l(w)}}),10)}(M.current,L,q,a,i,u,l,d,h,(function(e){return s({type:"setProgress",progress:e})}),(function(t){return s(Object(c.a)({type:"endExport"},e,t))}),"gif"===e?new S(d,h):new N(d,h))},startCapture:H,stopCapture:P}),a.a.createElement("div",{style:{height:"calc(100vh - 50px)",maxHeight:"calc(100vh - 50px)",width:"100vw",maxWidth:"100vw",padding:"1rem",backgroundColor:"#293742"}},a.a.createElement("div",{style:{width:"100%",maxWidth:"100%",height:"100%",maxHeight:"100%",position:"relative",display:"flex"},ref:A},a.a.createElement("div",{style:{position:"absolute",left:_,top:Y,width:$,height:K,pointerEvents:"none"}},o.isCropping&&a.a.createElement(E,{onCrop:function(e){return s({type:"endCropping",dimensions:e})},onCancel:function(){return s({type:"endCropping"})}})),o.chunksUrl?a.a.createElement(y,{frames:M.current,width:L,height:q,displayWidth:$,displayHeight:K}):a.a.createElement(h.NonIdealState,{title:a.a.createElement(a.a.Fragment,null,a.a.createElement("p",null,"screencatcher lets you record your desktop to an animated GIF or PNG.")),description:a.a.createElement(a.a.Fragment,null,a.a.createElement("p",null,"It works entirely from your browser so doesn't require any other applications to be installed and doesn't share data with the outside world.")),icon:"mobile-video",action:o.isRecording?void 0:a.a.createElement(h.Button,{onClick:function(){return H(0)},icon:"record"},"Click here to start recording")})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(231),n(232);o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(H,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[165,1,2]]]);
//# sourceMappingURL=main.3eff0729.chunk.js.map