(this.webpackJsonpgiffy=this.webpackJsonpgiffy||[]).push([[0],{165:function(e,t,n){e.exports=n(233)},170:function(e,t,n){},172:function(e,t,n){},206:function(e,t){},208:function(e,t){},218:function(e,t){},233:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(11),o=n.n(i),c=(n(170),n(57)),s=n(30),u=n.n(s),l=n(22),d=n(59),h=(n(172),n(6)),m=n(108),g=n.n(m),p=function(e){var t,n,r=e.state,i=e.dispatch,o=e.startCapture,c=e.stopCapture,s=e.durationSecs,u=e.onExport,l=btoa(new Uint8Array(r.png).reduce((function(e,t){return e+String.fromCharCode(t)}),""));return a.a.createElement(h.Navbar,null,a.a.createElement(h.NavbarGroup,null,a.a.createElement(h.NavbarHeading,null,a.a.createElement("h3",null,"screencatcher")),a.a.createElement(h.Button,{disabled:r.isRecording,onClick:o,icon:"record"},"Record"),a.a.createElement(h.Button,{disabled:!r.isRecording,onClick:c,icon:"stop"},"Stop")),a.a.createElement(h.NavbarGroup,{align:h.Alignment.RIGHT},a.a.createElement(h.Button,{icon:"zoom-to-fit",onClick:function(){return i({type:"startCropping"})}},"Crop"),a.a.createElement(h.NavbarDivider,null),a.a.createElement(h.Popover,{minimal:!0,content:a.a.createElement(h.Menu,null,a.a.createElement(h.MenuItem,{text:"Export to PNG",disabled:r.isConverting,onClick:function(){return u("png")}}),a.a.createElement(h.MenuItem,{text:"Export to GIF",disabled:r.isConverting,onClick:function(){return u("gif")}}),a.a.createElement(h.MenuDivider,null),a.a.createElement(h.MenuItem,{text:"Image Width"},[256,512,1024,2048].map((function(e){return a.a.createElement(h.MenuItem,{key:e,text:"".concat(e),icon:r.gifWidth===e?"tick":null,onClick:function(){return i({type:"setGifWidth",width:e})}})})),r.screenDimensions&&a.a.createElement(h.MenuItem,{key:"original",text:"Original: ".concat(null===(t=r.screenDimensions)||void 0===t?void 0:t[0]),icon:r.gifWidth===(null===(n=r.screenDimensions)||void 0===n?void 0:n[0])?"tick":null,onClick:function(){return i({type:"setGifWidth",width:r.screenDimensions[0]})}})))},a.a.createElement(h.Button,{icon:"export",text:"Export..."})),(r.png||r.gif)&&a.a.createElement(h.Popover,{minimal:!0,content:a.a.createElement(h.Menu,null,a.a.createElement(h.MenuItem,{text:"Download PNG",download:"screencatcher.png",href:"data:image/png;base64,".concat(l),target:"_blank",icon:"download",disabled:!r.png}),a.a.createElement(h.MenuItem,{text:"Download GIF",download:"screencatcher.gif",href:"data:image/gif;base64,".concat(r.gif),target:"_blank",icon:"download",disabled:!r.gif}))},a.a.createElement(h.Button,{icon:"download",text:"Download..."})),r.isConverting&&a.a.createElement(a.a.Fragment,null,a.a.createElement(h.NavbarDivider,null),a.a.createElement("div",{style:{width:"10rem"}},a.a.createElement(h.ProgressBar,{value:r.progress}))),a.a.createElement(h.NavbarDivider,null),"Duration: ",g()(s>0?s:0).format("0.0"),"s"))},f=n(113),v=n(41),w=n.n(v),b=Object(f.a)((function(e){return a.a.createElement("div",{ref:e.getRef,style:{position:"absolute",left:e.x,top:e.y,width:e.width,height:e.height,touchAction:"none",borderWidth:5,borderColor:"red",borderStyle:"solid",pointerEvents:"all"}},a.a.createElement("div",{style:{width:"100%",height:"100%"}},e.x,",",e.y,",",e.width,",",e.height," ",a.a.createElement(h.Button,{onClick:function(){return e.onCrop([e.x,e.y,e.width,e.height])}},"Crop"),a.a.createElement(h.Button,{onClick:function(){return e.onCropCancel()}},"Cancel")))})),E=function(e){var t=e.onCrop,n=e.onCancel,r=a.a.useState({x:0,y:0,width:300,height:200}),i=Object(l.a)(r,2),o=i[0],c=i[1];return a.a.createElement(b,Object.assign({onCrop:t,onCropCancel:n,resizable:{edges:{left:!0,right:!0,bottom:!0,top:!0},modifiers:[w.a.modifiers.restrictRect({restriction:"parent"})]},draggable:{modifiers:[w.a.modifiers.restrictRect({restriction:"parent"})]},onDragMove:function(e){return c((function(t){return{x:t.x+e.dx,y:t.y+e.dy,width:t.width,height:t.height}}))},onResizeMove:function(e){var t=e.rect,n=t.width,r=t.height,a=e.deltaRect,i=a.left,o=a.top;c((function(e){return{x:e.x+i,y:e.y+o,width:n,height:r}}))}},o))},y=function(e){var t=e.frames,n=e.width,i=e.height,o=e.displayWidth,c=e.displayHeight,s=a.a.useRef(null);return Object(r.useEffect)((function(){!function(){var e=0,n=Date.now(),r=s.current.getContext("2d");requestAnimationFrame((function a(){Date.now()-n>=t[e].timestamp&&(null===r||void 0===r||r.putImageData(t[e].imageData,0,0),(e+=1)>=t.length&&(e=0,n=Date.now())),requestAnimationFrame(a)}))}()}),[s,t]),a.a.createElement("canvas",{ref:s,width:n,height:i,style:{maxHeight:"100%",height:c,maxWidth:"100%",width:o,margin:"auto"}})},C=n(116),k=n(23),x={chunks:[],chunksUrl:"",isRecording:!1,isConverting:!1,screenDimensions:null,png:null,gif:null,gifWidth:1024,isCropping:!1,cropDimensions:null,progress:0,hasData:!1},D=function(e,t){switch(t.type){case"startRecording":return Object(k.a)({},e,{isRecording:!0,hasData:!0});case"recordChunk":return Object(k.a)({},e,{chunks:[].concat(Object(C.a)(e.chunks),[t.chunk])});case"stopRecording":return Object(k.a)({},e,{isRecording:!1,chunksUrl:URL.createObjectURL(e.chunks[0]),screenDimensions:[t.captureStream.getVideoTracks()[0].getSettings().width,t.captureStream.getVideoTracks()[0].getSettings().height]});case"startExport":return Object(k.a)({},e,{isConverting:!0});case"endExport":return Object(k.a)({},e,{isConverting:!1,progress:0,png:t.png?t.png:e.png,gif:t.gif?t.gif:e.gif});case"setGifWidth":return Object(k.a)({},e,{gifWidth:t.width});case"startCropping":return Object(k.a)({},e,{isCropping:!0});case"endCropping":return Object(k.a)({},e,{isCropping:!1,cropDimensions:t.dimensions?t.dimensions:e.cropDimensions});case"setProgress":return Object(k.a)({},e,{progress:t.progress})}return e},O=n(72),j=n(73),R=n(114),I=n.n(R),W=n(115),M=n.n(W),S=function(){function e(t,n){Object(O.a)(this,e),this.encoder=void 0,this.encoder=new I.a(t,n,{highWaterMark:5e7})}return Object(j.a)(e,[{key:"start",value:function(){this.encoder.writeHeader()}},{key:"addFrame",value:function(e,t){this.encoder.addFrame(e)}},{key:"finish",value:function(){return this.encoder.finish(),btoa(this.encoder.read().reduce((function(e,t){return e+String.fromCharCode(t)}),""))}}]),e}(),N=function(){function e(t,n){Object(O.a)(this,e),this.width=void 0,this.height=void 0,this.frames=void 0,this.dels=void 0,this.width=t,this.height=n,this.frames=[],this.dels=[]}return Object(j.a)(e,[{key:"start",value:function(){}},{key:"addFrame",value:function(e,t){this.frames.push(e),this.dels.push(t)}},{key:"finish",value:function(){return M.a.encode(this.frames,this.width,this.height,255,this.dels)}}]),e}();function F(e){return G.apply(this,arguments)}function G(){return(G=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,navigator.mediaDevices.getDisplayMedia(t);case 4:n=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),console.error("Error: "+e.t0),e.abrupt("return",null);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}var H={video:{cursor:"always"},audio:!1},B=function(){var e,t,n=Object(r.useReducer)(D,x),i=Object(l.a)(n,2),o=i[0],s=i[1],m=Object(r.useState)(null),g=Object(l.a)(m,2),f=g[0],v=g[1],w=Object(r.useState)(null),b=Object(l.a)(w,2),C=b[0],k=b[1],O=Object(r.useState)(null),j=Object(l.a)(O,2),R=j[0],I=j[1],W=Object(r.useState)(Date.now()),M=Object(l.a)(W,2),G=M[0],B=M[1],P=Object(r.useRef)([]),A=Object(r.useRef)(null);a.a.useEffect((function(){if(o.hasData){return window.onbeforeunload=function(e){return"You haven't saved your recording. Are you sure you want to leave?"},function(){window.onbeforeunload=null}}}),[o]);var T=function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,r,a,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(H);case 2:if(t=e.sent,n=document.createElement("video"),r=document.createElement("canvas"),a=r.getContext("2d"),t){e.next=8;break}return e.abrupt("return");case 8:n.srcObject=t,i=null,n.onloadeddata=function(){A.current=setInterval((function(){i||(i=Date.now(),r.width=n.videoWidth,r.height=n.videoHeight),console.log(n.videoWidth),console.log(n.videoHeight),null===a||void 0===a||a.drawImage(n,0,0),P.current.push({timestamp:Date.now()-i,imageData:null===a||void 0===a?void 0:a.getImageData(0,0,n.videoWidth,n.videoHeight)})}),100)},n.play(),o=new MediaRecorder(t),s({type:"startRecording"}),o.ondataavailable=function(e){return s({type:"recordChunk",chunk:e.data})},o.onstop=function(){s({type:"stopRecording",captureStream:t})},o.start(),k(Date.now()),v(o);case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f.stop(),I(Date.now()),console.log(P.current),clearInterval(A.current);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=Object(r.useRef)(),L=function(e){var t=function(){return{width:e.current.offsetWidth,height:e.current.offsetHeight}},n=Object(r.useState)({width:0,height:0}),a=Object(l.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){var n=function(){o(t())};return e.current&&o(t()),window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[e]),i}(z),q=L.width,J=L.height,V=null===(e=o.screenDimensions)||void 0===e?void 0:e[0],_=null===(t=o.screenDimensions)||void 0===t?void 0:t[1],Y=q/J,$=V/_,K=0,Q=0,X=q,Z=J;if($>Y){var ee=q/V*_;Q=.5*(J-ee),Z=ee}else if(Y>$){var te=J/_*V;K=.5*(q-te),X=te}Object(r.useEffect)((function(){setTimeout((function(){return B(Date.now())}),1e3)}),[G]);var ne=((R||G)-(C||G))/1e3;return a.a.createElement("div",{className:"App"},a.a.createElement("main",{className:"bp3-dark"},a.a.createElement(p,{state:o,dispatch:s,durationSecs:ne,onExport:function(e){s({type:"startExport"}),console.log(q,J);var t=1*V/X,n=1*_/Z,r=o.cropDimensions,a=r?Math.round(r[0]*t):0,i=r?Math.round(r[1]*n):0,u=r?Math.round(r[2]*t):V,l=r?Math.round(r[3]*n):_,d=r?Math.round(r[2]*t):o.gifWidth,h=r?Math.round(r[3]*n):_*o.gifWidth/V;!function(e,t,n,r,a,i,o,c,s,u,l,d){var h=document.createElement("canvas");h.width=t,h.height=n;var m=h.getContext("2d"),g=document.createElement("canvas");g.width=c,g.height=s;var p=g.getContext("2d"),f=0;d.start();setTimeout((function t(){var n=e[f];u(1*f/e.length),null===m||void 0===m||m.putImageData(n.imageData,0,0),null===p||void 0===p||p.drawImage(h,r,a,i,o,0,0,c,s);var g=null===p||void 0===p?void 0:p.getImageData(0,0,c,s),v=f>=1?e[f-1].timestamp:0;if(d.addFrame(g.data,n.timestamp-v),++f<e.length)setTimeout(t,10);else{var w=d.finish();l(w)}}),10)}(P.current,V,_,a,i,u,l,d,h,(function(e){return s({type:"setProgress",progress:e})}),(function(t){return s(Object(c.a)({type:"endExport"},e,t))}),"gif"==e?new S(d,h):new N(d,h))},startCapture:T,stopCapture:U}),a.a.createElement("div",{style:{height:"calc(100vh - 50px)",maxHeight:"calc(100vh - 50px)",width:"100vw",maxWidth:"100vw",padding:"1rem",backgroundColor:"#293742"}},a.a.createElement("div",{style:{width:"100%",maxWidth:"100%",height:"100%",maxHeight:"100%",position:"relative",display:"flex"},ref:z},a.a.createElement("div",{style:{position:"absolute",left:K,top:Q,width:X,height:Z,pointerEvents:"none"}},o.isCropping&&a.a.createElement(E,{onCrop:function(e){return s({type:"endCropping",dimensions:e})},onCancel:function(){return s({type:"endCropping"})}})),o.chunksUrl?a.a.createElement(y,{frames:P.current,width:V,height:_,displayWidth:X,displayHeight:Z}):a.a.createElement(h.NonIdealState,{title:a.a.createElement(a.a.Fragment,null,a.a.createElement("p",null,"screencatcher lets you record your desktop to an animated GIF or PNG.")),description:a.a.createElement(a.a.Fragment,null,a.a.createElement("p",null,"It works entirely from your browser so doesn't require any other applications to be installed and doesn't share data with the outside world.")),icon:"mobile-video",action:o.isRecording?void 0:a.a.createElement(h.Button,{onClick:T,icon:"record"},"Click here to start recording")})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(231),n(232);o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(B,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[165,1,2]]]);
//# sourceMappingURL=main.1fa0cde5.chunk.js.map